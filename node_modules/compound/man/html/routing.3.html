<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='content-type' value='text/html;charset=utf8'>
  <meta name='generator' value='Ronn/v0.7.3 (http://github.com/rtomayko/ronn/tree/0.7.3)'>
  <title>compound-routing(3) - compound map drawer</title>
  <style type='text/css' media='all'>
  /* style: man */
  body#manpage {margin:0}
  .mp {max-width:100ex;padding:0 9ex 1ex 4ex}
  .mp p,.mp pre,.mp ul,.mp ol,.mp dl {margin:0 0 20px 0}
  .mp h2 {margin:10px 0 0 0}
  .mp > p,.mp > pre,.mp > ul,.mp > ol,.mp > dl {margin-left:8ex}
  .mp h3 {margin:0 0 0 4ex}
  .mp dt {margin:0;clear:left}
  .mp dt.flush {float:left;width:8ex}
  .mp dd {margin:0 0 0 9ex}
  .mp h1,.mp h2,.mp h3,.mp h4 {clear:left}
  .mp pre {margin-bottom:20px}
  .mp pre+h2,.mp pre+h3 {margin-top:22px}
  .mp h2+pre,.mp h3+pre {margin-top:5px}
  .mp img {display:block;margin:auto}
  .mp h1.man-title {display:none}
  .mp,.mp code,.mp pre,.mp tt,.mp kbd,.mp samp,.mp h3,.mp h4 {font-family:monospace;font-size:14px;line-height:1.42857142857143}
  .mp h2 {font-size:16px;line-height:1.25}
  .mp h1 {font-size:20px;line-height:2}
  .mp {text-align:justify;background:#fff}
  .mp,.mp code,.mp pre,.mp pre code,.mp tt,.mp kbd,.mp samp {color:#131211}
  .mp h1,.mp h2,.mp h3,.mp h4 {color:#030201}
  .mp u {text-decoration:underline}
  .mp code,.mp strong,.mp b {font-weight:bold;color:#131211}
  .mp em,.mp var {font-style:italic;color:#232221;text-decoration:none}
  .mp a,.mp a:link,.mp a:hover,.mp a code,.mp a pre,.mp a tt,.mp a kbd,.mp a samp {color:#0000ff}
  .mp b.man-ref {font-weight:normal;color:#434241}
  .mp pre {padding:0 4ex}
  .mp pre code {font-weight:normal;color:#434241}
  .mp h2+pre,h3+pre {padding-left:0}
  ol.man-decor,ol.man-decor li {margin:3px 0 10px 0;padding:0;float:left;width:33%;list-style-type:none;text-transform:uppercase;color:#999;letter-spacing:1px}
  ol.man-decor {width:100%}
  ol.man-decor li.tl {text-align:left}
  ol.man-decor li.tc {text-align:center;letter-spacing:4px}
  ol.man-decor li.tr {text-align:right;float:right}
  </style>
  <style type='text/css' media='all'>
  /* style: toc */
  .man-navigation {display:block !important;position:fixed;top:0;left:113ex;height:100%;width:100%;padding:48px 0 0 0;border-left:1px solid #dbdbdb;background:#eee}
  .man-navigation a,.man-navigation a:hover,.man-navigation a:link,.man-navigation a:visited {display:block;margin:0;padding:5px 2px 5px 30px;color:#999;text-decoration:none}
  .man-navigation a:hover {color:#111;text-decoration:underline}
  </style>
</head>
<!--
  The following styles are deprecated and will be removed at some point:
  div#man, div#man ol.man, div#man ol.head, div#man ol.man.

  The .man-page, .man-decor, .man-head, .man-foot, .man-title, and
  .man-navigation should be used instead.
-->
<body id='manpage'>
  <div class='mp' id='man'>

  <div class='man-navigation' style='display:none'>
    <a href="#NAME">NAME</a>
    <a href="#DESCRIPTION">DESCRIPTION</a>
    <a href="#FILE">FILE</a>
    <a href="#EVENT">EVENT</a>
    <a href="#BASIC-ROUTING-METHODS">BASIC ROUTING METHODS</a>
    <a href="#URL-HELPERS">URL HELPERS</a>
    <a href="#ADVANCED-ROUTING-METHODS">ADVANCED ROUTING METHODS</a>
    <a href="#EXAMPLES">EXAMPLES</a>
    <a href="#DEBUGGING">DEBUGGING</a>
    <a href="#CONTRIBUTION">CONTRIBUTION</a>
    <a href="#SEE-ALSO">SEE ALSO</a>
  </div>

  <ol class='man-decor man-head man head'>
    <li class='tl'>compound-routing(3)</li>
    <li class='tc'>CompoundJS</li>
    <li class='tr'>compound-routing(3)</li>
  </ol>

  <h2 id="NAME">NAME</h2>
<p class="man-name">
  <code>compound-routing</code> - <span class="man-whatis">compound map drawer</span>
</p>

<h2 id="DESCRIPTION">DESCRIPTION</h2>

<p>The purpose of routes is to bind an URL to controller action.</p>

<h2 id="FILE">FILE</h2>

<p><code>config/routes.js</code> should export <code>routes(map)</code> function:</p>

<pre><code>exports.routes = function draw(map) {
    map.root('dashboard#home');
    map.namespace('admin', function(admin) {
        admin.resources('users');
    });
};
</code></pre>

<h2 id="EVENT">EVENT</h2>

<p>The <code>routes</code> event can be used on compound object to define routes:</p>

<pre><code>compound.on('routes', function(map, compound) {
    map.get('auth', 'session#auth');
});
</code></pre>

<p>It could be useful when you want to define some routes before application
initialization. When app initialized use <code>compound.map</code> object.</p>

<h2 id="BASIC-ROUTING-METHODS">BASIC ROUTING METHODS</h2>

<p>To define routes we have map object which have number of methods:</p>

<dl>
<dt class="flush"><code>get</code></dt><dd><p>Define route for GET method.</p></dd>
<dt class="flush"><code>post</code></dt><dd><p>Define route for POST method.</p></dd>
<dt class="flush"><code>put</code></dt><dd><p>Define route for PUT method.</p></dd>
<dt class="flush"><code>del</code></dt><dd><p>Define route for DELETE method.</p></dd>
<dt class="flush"><code>all</code></dt><dd><p>Define route for all http methods.</p></dd>
</dl>


<p>All these methods have following signature:</p>

<pre><code>map.get(path, handler, middleware, options);
</code></pre>

<p>Params meaning:</p>

<dl>
<dt class="flush"><code>path</code></dt><dd><p>some path, which could contain params, see <a href="#ROUTE-PATH-PARAMS" title="ROUTE PATH PARAMS" data-bare-link="true">ROUTE PATH PARAMS</a></p></dd>
<dt class="flush"><code>handler</code></dt><dd><p>string <code>controllerName#actionName</code>, see <a href="#ROUTE-HANDLER" title="ROUTE HANDLER" data-bare-link="true">ROUTE HANDLER</a></p></dd>
<dt><code>middleware</code></dt><dd><p>function or array of functions (optional), see <a href="#MIDDLEWARE" title="MIDDLEWARE" data-bare-link="true">MIDDLEWARE</a></p></dd>
<dt class="flush"><code>options</code></dt><dd><p>object containing params for route (optional), see <a href="#ROUTE-OPTIONS" title="ROUTE OPTIONS" data-bare-link="true">ROUTE OPTIONS</a></p></dd>
</dl>


<h3 id="ROUTE-PATH-PARAMS">ROUTE PATH PARAMS</h3>

<p>Path may contain params - words started with colon ":". Parameter is optional
when param name followed by question mark "?". After matching request param
values populated <code>req.params</code> object.</p>

<h3 id="ROUTE-HANDLER">ROUTE HANDLER</h3>

<p>Route handler is a string composed from <code>controllerName</code> and <code>actionName</code>
separated by <code>#</code> sign. When route nested inside resource <code>controllerName</code> could
be optional, in that case resource controller name assumed:</p>

<pre><code>map.resources('posts', function (post) {
    // map '/posts/destroyAll'
    // to {controller: 'posts', action: 'cleanup'}
    post.get('destroyAll', '#cleanup', {collection: true});
});
</code></pre>

<p>Route handler could be skipped at all when route nested inside resource, then
actionName assumed to equals path:</p>

<pre><code>map.resources('posts', function (post) {
    // map '/posts/:post_id/commentsCount'
    // to {controller: 'posts', action: 'commentsCount'}
    post.get('commentsCount');
});
</code></pre>

<h3 id="MIDDLEWARE">MIDDLEWARE</h3>

<p>You may want to use middleware in routes. It's not recommended, but if you need
it you can put it as second argument:</p>

<pre><code>map.get('/admin', 'admin#index', authenticate);
map.get('/protected/resource', 'resource#access', [middleware1, middleware2]);
</code></pre>

<h3 id="ROUTE-OPTIONS">ROUTE OPTIONS</h3>

<dl>
<dt class="flush"><code>as</code></dt><dd><p>Specify custom URL helper name</p>

<p>  map.get('/some/action', 'some#action', {as: 'myAction'});
  pathTo.myAction() => '/some/action'</p></dd>
<dt><code>subdomain</code></dt><dd><p>Check HTTP/1.1 Host header when matching request, use * as wildcard domain:</p>

<p>  map.get('/url', 'ctl#action', {subdomain: 'subdomain.tld'});
  map.get('/url', 'ctl#action', {subdomain: '*.example.com'});</p></dd>
</dl>


<p>A subdomain match will ignore the first- and second-level components of the
domain. This value is hard-coded into the <code>ControllerBridge</code> class.</p>

<p><em>NOTE</em>: This feature relies on <code>Host</code> HTTP/1.1 header, if your Node process
behind a proxy (like Nginx), make sure you've passed this header to CompoundJS.</p>

<dl>
<dt class="flush"><code>vhost</code></dt><dd><p>Constrains the route match to include the given virtual host name</p>

<p>  map.get('/apples/:id', 'fruit#action', {vhost: '.fruit.com'});
  map.get('/carrots/:id', 'vegetable#action', {vhost: 'vegetables.com'});</p></dd>
</dl>


<p>In the examples above, the <code>/apples/:id</code> route matches <code>http://fruit.com</code> and
<code>http://*.fruit.com</code>, while the <code>/carrots/:id</code> route will only match
<code>http://vegetables.com</code>.</p>

<p>Compared to the <code>subdomain</code> option, the <code>vhost</code> option allows for a more
straightforward route constraint on domain name.</p>

<p><em>NOTE</em>: Like the <code>subdomain</code> feature, this relies on <code>Host</code> HTTP/1.1 header.</p>

<h2 id="URL-HELPERS">URL HELPERS</h2>

<p>URL helpers provide you convenient way to work with paths in your app. When you
define route:</p>

<pre><code>map.get('bunny', 'bunny#show');
</code></pre>

<p>you can use <code>pathTo.bunny</code> in your controllers and views, which will generate</p>

<pre><code>/bunny
</code></pre>

<p>path for you. You also can specify another helper name is you want using <code>as</code>
param:</p>

<pre><code>map.get('bunny', 'bunny#show', {as: 'rabbit'});
</code></pre>

<p>and now <code>pathTo.rabbit</code> available.</p>

<p>If your route has param, for example</p>

<pre><code>map.get('profile/:user', 'users#show');
map.get('posts/:post_id/comments/:comment_id', 'comments#show');
</code></pre>

<p>URL helper will accept parameter (String), so that:</p>

<pre><code>pathTo.profile('Bugs_Bunny', 'users#show');
&gt; '/profile/Bugs_Bunny'
pathTo.post_comment(2, 2383);
&gt; '/posts/2/comments/2383'
</code></pre>

<p>To learn how to get list of generated url helpers see <a href="#DEBUGGING" title="DEBUGGING" data-bare-link="true">DEBUGGING</a> section.</p>

<h2 id="ADVANCED-ROUTING-METHODS">ADVANCED ROUTING METHODS</h2>

<h3 id="NAMESPACES">NAMESPACES</h3>

<p>You may wish to organize groups of controllers under a namespace. The most common use-case is an administration area. All controllers within the <code>admin</code> namespace should be located inside the <code>app/controllers/</code> directory.</p>

<p>For example, let's create an admin namespace:</p>

<pre><code>map.namespace('admin', function (admin) {
    admin.resources('users');
});
</code></pre>

<p>This routing rule will match with <code>/admin/users</code>, <code>/admin/users/new</code> and will create appropriate url helpers:</p>

<pre><code>    admin_users GET    /admin/users.:format?          admin/users#index
    admin_users POST   /admin/users.:format?          admin/users#create
 new_admin_user GET    /admin/users/new.:format?      admin/users#new
edit_admin_user GET    /admin/users/:id/edit.:format? admin/users#edit
     admin_user DELETE /admin/users/:id.:format?      admin/users#destroy
     admin_user PUT    /admin/users/:id.:format?      admin/users#update
     admin_user GET    /admin/users/:id.:format?      admin/users#show
</code></pre>

<h3 id="RESOURCES">RESOURCES</h3>

<p>Resource-based routing provides standard mapping between HTTP verbs and controller actions:</p>

<pre><code>map.resources('posts');
</code></pre>

<p>will provide the following routes:</p>

<pre><code>  helper | method | path                   | controller#action
    posts GET      /posts                   posts#index
    posts POST     /posts                   posts#create
 new_post GET      /posts/new               posts#new
edit_post GET      /posts/:id/edit          posts#edit
     post DELETE   /posts/:id               posts#destroy
     post PUT      /posts/:id               posts#update
     post GET      /posts/:id               posts#show.
</code></pre>

<p>To list all available routes you can run the command <code>compound routes</code>.</p>

<p>The first column of the table represents the <code>helper</code> - you can use this identifier in views and controllers to get the route. Some examples:</p>

<p>```
path_to.new_post            # /posts/new
<span class="man-ref">path_to.edit_post<span class="s">(1)</span></span>        # /posts/1/edit
path_to.edit_post(post)     # /posts/1/edit (in this example post = {id: 1})
path_to.posts               # /posts
path_to.post(post)          # /posts/1.</p>

<p>```</p>

<p><strong>OPTIONS</strong></p>

<p>If you want to override default routes behaviour, you can use two options: <code>as</code> and <code>path</code> to specify a helper name and a path you want to have in the result.</p>

<dl>
<dt><code>{ as: 'helperName' }</code></dt><dd><p>Path helper aliasing:</p>

<p>  map.resources('posts', { as: 'articles' });</p></dd>
</dl>


<p>This will create the following routes:</p>

<pre><code>    articles GET    /posts.:format?          posts#index
    articles POST   /posts.:format?          posts#create
 new_article GET    /posts/new.:format?      posts#new
edit_article GET    /posts/:id/edit.:format? posts#edit
     article DELETE /posts/:id.:format?      posts#destroy
     article PUT    /posts/:id.:format?      posts#update
     article GET    /posts/:id.:format?      posts#show.
</code></pre>

<dl>
<dt><code>{ path: 'alternatePath' }</code></dt><dd><p>If you want to change the base path:</p>

<p>  map.resources('posts', { path: 'articles' });</p></dd>
</dl>


<p>This will create the following routes:</p>

<pre><code>    posts GET    /articles.:format?          posts#index
    posts POST   /articles.:format?          posts#create
 new_post GET    /articles/new.:format?      posts#new
edit_post GET    /articles/:id/edit.:format? posts#edit
     post DELETE /articles/:id.:format?      posts#destroy
     post PUT    /articles/:id.:format?      posts#update
     post GET    /articles/:id.:format?      posts#show
</code></pre>

<dl>
<dt><code>Both "as" and "path" together</code>:</dt><dd></dd>
</dl>


<p>If you want to alias both the helper and the path:</p>

<pre><code>map.resources('posts', { path: 'articles', as: 'stories' });
</code></pre>

<p>This will create the following routes:</p>

<pre><code>   stories GET    /articles.:format?          posts#index
   stories POST   /articles.:format?          posts#create
 new_story GET    /articles/new.:format?      posts#new
edit_story GET    /articles/:id/edit.:format? posts#edit
     story DELETE /articles/:id.:format?      posts#destroy
     story PUT    /articles/:id.:format?      posts#update
     story GET    /articles/:id.:format?      posts#show
</code></pre>

<dl>
<dt class="flush"><code>only</code></dt><dd><p>If you need routes only for several actions (e.g. <code>index</code>, <code>show</code>), you can specify the <code>only</code> option:</p>

<p>  map.resources('users', { only: ['index', 'show'] });</p></dd>
<dt class="flush"><code>except</code></dt><dd><p>If you want to have all routes except a specific route, you can specify the <code>except</code> option:</p>

<p>  map.resources('users', { except: ['create', 'destroy'] });</p></dd>
</dl>


<p><strong>Nested resources</strong></p>

<p>Some resources may have nested sub-resources, for example <code>Post</code> has many <code>Comments</code>, and of course we want to get a post's comments using <code>GET /post/1/comments</code>.</p>

<p>Let's describe the route for our nested resource:</p>

<pre><code>map.resources('post', function (post) {
    post.resources('comments');
});.
</code></pre>

<p>This routing map will provide the following routes:</p>

<pre><code>$ compound routes
     post_comments GET      /posts/:post_id/comments          comments#index
     post_comments POST     /posts/:post_id/comments          comments#create
  new_post_comment GET      /posts/:post_id/comments/new      comments#new
 edit_post_comment GET      /posts/:post_id/comments/:id/edit comments#edit
      post_comment DELETE   /posts/:post_id/comments/:id      comments#destroy
      post_comment PUT      /posts/:post_id/comments/:id      comments#update
      post_comment GET      /posts/:post_id/comments/:id      comments#show
             posts GET      /posts                            posts#index
             posts POST     /posts                            posts#create
          new_post GET      /posts/new                        posts#new
         edit_post GET      /posts/:id/edit                   posts#edit
              post DELETE   /posts/:id                        posts#destroy
              post PUT      /posts/:id                        posts#update
              post GET      /posts/:id                        posts#show.
</code></pre>

<p><strong>Using url helpers for nested routes</strong></p>

<p>To use routes like <code>post_comments</code> you should call helper with param: parent resource or identifier before nested resource:</p>

<pre><code>path_to.post_comments(post)               # /posts/1/comments
path_to.edit_post_comment(post, comment)  # /posts/1/comments/10/edit
path_to.edit_post_comment(2, 300)         # /posts/2/comments/300/edit
</code></pre>

<p><strong>Custom actions in resourceful routes</strong></p>

<p>If you need some specific action to be added to your resource-based route, use this example:</p>

<pre><code>map.resource('users', function (user) {
    user.get('avatar', 'users#avatar');               // /users/:user_id/avatar
    user.get('top', 'users#top', {collection: true}); // /users/top
});
</code></pre>

<h2 id="EXAMPLES">EXAMPLES</h2>

<p>To link <code>GET /signup</code> with <code>new</code> action of <code>users</code> controller:</p>

<pre><code>map.get('signup', 'users#new');
</code></pre>

<p>The following route will link <code>GET /</code> to the <code>index</code> action of the<code>home</code> controller:</p>

<pre><code>map.root('home#index');
</code></pre>

<h2 id="DEBUGGING">DEBUGGING</h2>

<p>To debug routes of your compound application you can use <code>compound routes</code>
command (or shortcut <code>compound r</code>). You can also specify optional argument for
filtering by helper name or method, for example:</p>

<pre><code>~: ) compound r post
     posts GET    /posts.:format?          posts#index
     posts POST   /posts.:format?          posts#create
  new_post GET    /posts/new.:format?      posts#new
 edit_post GET    /posts/:id/edit.:format? posts#edit
      post DELETE /posts/:id.:format?      posts#destroy
      post PUT    /posts/:id.:format?      posts#update
      post GET    /posts/:id.:format?      posts#show
~: ) compound r GET
     posts GET    /posts.:format?          posts#index
  new_post GET    /posts/new.:format?      posts#new
 edit_post GET    /posts/:id/edit.:format? posts#edit
      post GET    /posts/:id.:format?      posts#show
~: ) compound r new
 new_post GET    /posts/new.:format? posts#new
</code></pre>

<h2 id="CONTRIBUTION">CONTRIBUTION</h2>

<p>Compound use <code>railway-routes</code> npm package to provide routes functionality. If
you spotted an bug or have any suggestions or requests feel free to open issue
at
<a href="https://github.com/1602/railway-routes/issues">github.com/1602/railway-routes</a></p>

<h2 id="SEE-ALSO">SEE ALSO</h2>

<p><a class="man-ref" href="tools.3.html">compound-tools<span class="s">(3)</span></a> <a class="man-ref" href="tools.1.html">compound-tools<span class="s">(1)</span></a> <a class="man-ref" href="controller.3.html">compound-controller<span class="s">(3)</span></a></p>


  <ol class='man-decor man-foot man foot'>
    <li class='tl'>1602 Software</li>
    <li class='tc'>August 2013</li>
    <li class='tr'>compound-routing(3)</li>
  </ol>

  </div>
</body>
</html>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23280347-1']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
   })();

</script>
<script>
    var filename = location.href.match(/([^\/]+)?\.3.html(#.*?)?$/);
    var div = document.createElement('div');
    div.innerHTML = 'Found a typo? ' +
        linkTo('View', 'blob') +
        ' and ' +
        'edit' +
        //linkTo('edit', 'edit') +
        ' this file online at GitHub.';

    document.getElementById('man').appendChild(div);

    function linkTo(text, dir) {
        return '<a href="https://github.com/1602/compound/' +
            dir + '/master/man/api/' + filename[1] + '.md">' + text + '</a>';
    }

    if (filename) {
        addLink('h3', '&para;');
        addLink('h2', '&sect;');
    }

    function addLink(tag, sign) {
        var els = document.getElementsByTagName(tag);
        for (var i = 0; i < els.length; i += 1) {
            var el = els[i];
            el.innerHTML = '<a class="section-link" href="#' + el.id +
                '">' + sign + '</a>' + el.innerHTML;
            // el.style = 'margin-left: -1em';
        }
    }
</script>
<style>
    .section-link {
        visibility: hidden;
    }

    .mp h1, .mp h2, .mp h3 {
        position: relative;
        left: -1em;
    }

    a.section-link:hover,
    a.section-link:link,
    a.section-link {
        color: #999;
        text-decoration: none;
    }

    h1:hover .section-link,
    h2:hover .section-link,
    h3:hover .section-link {
        visibility: visible;
    }

    .mp pre code {
        color: #565758;
    }

    /*
    pre {
        background: #eee;
    }
    */
</style>
